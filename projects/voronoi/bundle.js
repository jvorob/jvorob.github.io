!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=8)}({8:function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"create",function(){return a}),n.d(r,"clone",function(){return c}),n.d(r,"fromValues",function(){return f}),n.d(r,"copy",function(){return l}),n.d(r,"set",function(){return d}),n.d(r,"add",function(){return h}),n.d(r,"subtract",function(){return g}),n.d(r,"multiply",function(){return v}),n.d(r,"divide",function(){return p}),n.d(r,"ceil",function(){return w}),n.d(r,"floor",function(){return E}),n.d(r,"min",function(){return m}),n.d(r,"max",function(){return y}),n.d(r,"round",function(){return x}),n.d(r,"scale",function(){return b}),n.d(r,"scaleAndAdd",function(){return M}),n.d(r,"distance",function(){return A}),n.d(r,"squaredDistance",function(){return S}),n.d(r,"length",function(){return k}),n.d(r,"squaredLength",function(){return I}),n.d(r,"negate",function(){return P}),n.d(r,"inverse",function(){return _}),n.d(r,"normalize",function(){return D}),n.d(r,"dot",function(){return O}),n.d(r,"cross",function(){return F}),n.d(r,"lerp",function(){return V}),n.d(r,"random",function(){return N}),n.d(r,"transformMat2",function(){return T}),n.d(r,"transformMat2d",function(){return L}),n.d(r,"transformMat3",function(){return R}),n.d(r,"transformMat4",function(){return C}),n.d(r,"rotate",function(){return H}),n.d(r,"angle",function(){return j}),n.d(r,"zero",function(){return U}),n.d(r,"str",function(){return q}),n.d(r,"exactEquals",function(){return z}),n.d(r,"equals",function(){return B}),n.d(r,"len",function(){return Y}),n.d(r,"sub",function(){return X}),n.d(r,"mul",function(){return Z}),n.d(r,"div",function(){return J}),n.d(r,"dist",function(){return K}),n.d(r,"sqrDist",function(){return Q}),n.d(r,"sqrLen",function(){return $}),n.d(r,"forEach",function(){return tt});var i={};n.r(i),n.d(i,"edgeWalkForEach",function(){return bt}),n.d(i,"isInnerComponent",function(){return St}),n.d(i,"IntersectType",function(){return Et}),n.d(i,"edgeIntersectLineCombinatoric",function(){return kt}),n.d(i,"lineIntersectWalk",function(){return It}),n.d(i,"DCEL",function(){return Dt}),n.d(i,"Vertex",function(){return Ot}),n.d(i,"HalfEdge",function(){return Ft}),n.d(i,"Face",function(){return Vt}),n.d(i,"Integrity",function(){return _t});var o=1e-6,s="undefined"!=typeof Float32Array?Float32Array:Array,u=Math.random;Math.PI;function a(){var t=new s(2);return s!=Float32Array&&(t[0]=0,t[1]=0),t}function c(t){var e=new s(2);return e[0]=t[0],e[1]=t[1],e}function f(t,e){var n=new s(2);return n[0]=t,n[1]=e,n}function l(t,e){return t[0]=e[0],t[1]=e[1],t}function d(t,e,n){return t[0]=e,t[1]=n,t}function h(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function g(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function v(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function p(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function w(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function E(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function m(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function y(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function x(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function b(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function M(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t}function A(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}function S(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function k(t){var e=t[0],n=t[1];return Math.sqrt(e*e+n*n)}function I(t){var e=t[0],n=t[1];return e*e+n*n}function P(t,e){return t[0]=-e[0],t[1]=-e[1],t}function _(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function D(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function O(t,e){return t[0]*e[0]+t[1]*e[1]}function F(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t}function V(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t}function N(t,e){e=e||1;var n=2*u()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t}function T(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t}function L(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t}function R(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t}function C(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}function H(t,e,n,r){var i=e[0]-n[0],o=e[1]-n[1],s=Math.sin(r),u=Math.cos(r);return t[0]=i*u-o*s+n[0],t[1]=i*s+o*u+n[1],t}function j(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=n*n+r*r;s>0&&(s=1/Math.sqrt(s));var u=i*i+o*o;u>0&&(u=1/Math.sqrt(u));var a=(n*i+r*o)*s*u;return a>1?0:a<-1?Math.PI:Math.acos(a)}function U(t){return t[0]=0,t[1]=0,t}function q(t){return"vec2("+t[0]+", "+t[1]+")"}function z(t,e){return t[0]===e[0]&&t[1]===e[1]}function B(t,e){var n=t[0],r=t[1],i=e[0],s=e[1];return Math.abs(n-i)<=o*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))}var G,W,Y=k,X=g,Z=v,J=p,K=A,Q=S,$=I,tt=(G=a(),function(t,e,n,r,i,o){var s,u;for(e||(e=2),n||(n=0),u=r?Math.min(r*e+n,t.length):t.length,s=n;s<u;s+=e)G[0]=t[s],G[1]=t[s+1],i(G,G,o),t[s]=G[0],t[s+1]=G[1];return t}),et=function(){function t(t){this.canvas=t,this.fieldSize=1.1,this.ctx=t.getContext("2d")}return t.prototype.getCanvasSize=function(){return r.fromValues(this.canvas.width,this.canvas.height)},t.prototype.getScaleFactor=function(){return Math.min(this.canvas.width,this.canvas.height)/this.fieldSize/2},t.prototype.world2screen=function(t){var e=r.fromValues(1,-1),n=this.getCanvasSize(),i=r.create();r.scale(i,n,.5);var o=r.clone(t);return r.scale(o,o,this.getScaleFactor()),r.multiply(o,o,e),r.add(o,o,i),o},t.prototype.screen2world=function(t){var e=r.fromValues(1,-1),n=this.getCanvasSize(),i=r.create();r.scale(i,n,.5);var o=r.clone(t);return r.subtract(o,o,i),r.multiply(o,o,e),r.scale(o,o,1/this.getScaleFactor()),o},t.prototype.clear=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.drawAxes=function(){this.putRect(r.fromValues(-1,-1),r.fromValues(1,1)),this.putLine(r.fromValues(-1,0),r.fromValues(1,0)),this.putLine(r.fromValues(0,-1),r.fromValues(0,1))},t.prototype.putPoint=function(t,e,n){void 0===e&&(e=2),void 0===n&&(n="black");var r=this.world2screen(t);this.ctx.save(),this.ctx.fillStyle=n,this.fillCircle(r,e),this.ctx.restore()},t.prototype.putLine=function(t,e,n){void 0===n&&(n="black"),this.ctx.save(),this.ctx.strokeStyle=n,this.ctx.lineWidth=1.5;var r=this.world2screen(t),i=this.world2screen(e);this.strokeLine(r,i),this.ctx.restore()},t.prototype.putRect=function(t,e){var n=this.world2screen(t),r=this.world2screen(e),i=Math.min(n[0],r[0]),o=Math.max(n[0],r[0]),s=Math.min(n[1],r[1]),u=o-i,a=Math.max(n[1],r[1])-s;this.ctx.strokeRect(i,s,u,a)},t.prototype.fillCircle=function(t,e){this.ctx.beginPath(),this.ctx.ellipse(t[0],t[1],e,e,0,0,6.2831853),this.ctx.fill()},t.prototype.strokeLine=function(t,e){this.ctx.beginPath(),this.ctx.moveTo(t[0],t[1]),this.ctx.lineTo(e[0],e[1]),this.ctx.stroke()},t}(),nt=1e-5,rt=1e-5;function it(t,e,n){return(n[1]-t[1])*(e[0]-t[0])-(n[0]-t[0])*(e[1]-t[1])}function ot(t,e){return r.dist(t,e)<nt}function st(t,e,n){var r=(n[0]-e[0])*(n[0]-e[0])+(n[1]-e[1])*(n[1]-e[1]);return Math.abs(it(e,n,t))/Math.sqrt(r)}function ut(t,e,n){var i=lt(e,n,0,1),o=lt(n,e,0,1);return it(e,i,t)>0?r.dist(e,t):it(n,o,t)>0?r.dist(n,t):st(t,e,n)}function at(t,e,n,i){var o=it(n,i,t),s=it(n,i,e);return Math.abs(o)<rt?r.clone(t):Math.abs(s)<rt?r.clone(e):o>0&&s<0||o<0&&s>0?function(t,e,n,r){var i=dt(t,e,n),o=dt(t,e,r),s=function(t,e){if(Math.abs(t[1]-e[1])<rt)return null;if(Math.abs(t[0]-e[0])<rt)return t[0];var n=(e[0]-t[0])/(e[1]-t[1]);return t[0]-t[1]*n}(i,o);if(null==s)return null;return lt(t,e,s,0)}(t,e,n,i):null}function ct(t,e,n){var i=function(t,e,n){var i=(n[0]-t[0])*(e[0]-t[0])+(n[1]-t[1])*(e[1]-t[1]),o=(n[1]-t[1])*(e[0]-t[0])-(n[0]-t[0])*(e[1]-t[1]);return r.fromValues(i,o)}(t,e,n);return function(t,e){if(0==t&&0==e)throw Error("pseudoAngle(0,0) is undefined");var n=t/(Math.abs(t)+Math.abs(e));return e>=0?1-n:n+3}(i[0],i[1])}function ft(t,e,n){var r=(n[0]-t[0])*(e[0]-t[0])+(n[1]-t[1])*(e[1]-t[1]),i=(n[1]-t[1])*(e[0]-t[0])-(n[0]-t[0])*(e[1]-t[1]),o=r/(Math.abs(r)+Math.abs(i));return i>=0?1-o:o+3}function lt(t,e,n,i){var o=r.fromValues(e[0]-t[0],e[1]-t[1]),s=r.fromValues(t[1]-e[1],e[0]-t[0]),u=r.create();return r.scaleAndAdd(u,u,o,n),r.scaleAndAdd(u,u,s,i),r.scaleAndAdd(u,u,t,1),u}function dt(t,e,n){var i=r.fromValues(n[0]-t[0],n[1]-t[1]);return function(t,e){var n=t[0]*t[0]+t[1]*t[1],i=(t[0]*e[0]+t[1]*e[1])/n,o=(-t[1]*e[0]+t[0]*e[1])/n;return r.fromValues(i,o)}(r.fromValues(e[0]-t[0],e[1]-t[1]),i)}function ht(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=document.createElement(t);return e.forEach(function(t){if(t instanceof HTMLElement)r.appendChild(t);else if("string"==typeof t)if("."==t[0])r.classList.add(t.slice(1));else if("#"==t[0])r.id=t;else if("@"==t[0]){var e=t.match(/@([^=]+)=(.+)/);if(!e)throw Error("Attributes should be like @key=value, failed to parse: "+t);console.log(e),r.setAttribute(e[1],e[2])}else r.appendChild(document.createTextNode(t))}),r}function gt(){var t=r.fromValues(2*Math.random()-1,2*Math.random()-1);return r.len(t)>1?gt():t}function vt(t){return null==t?"(null)":"("+t[0].toPrecision(3)+", "+t[1].toPrecision(3)+")"}function pt(t,e){if(0==t.length)throw Error("min called on empty array");for(var n=t[0],r=e(t[0]),i=1;i<t.length;i++){var o=e(t[i]);o<r&&(n=t[i],r=o)}return n}window.dom=ht;var wt,Et,mt=(wt=function(t,e){return(wt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}wt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),yt=!0;function xt(t,e,n,r){for(var i=t,o=r;o=n(o,i),(i=e(i))!=t;);return o}function bt(t,e,n){for(var r=t;n(r),(r=e(r))!=t;);}function Mt(t,e,n){return xt(t,e,function(t,e){var r=t;return n(e,r)<=0?e:r},t)}function At(t,e,n){return xt(t,e,function(t,e){return t||e==n},!1)}function St(t){t.origin;var e=Mt(t,function(t){return t.next},function(t,e){var n=t.origin.v,r=e.origin.v;if(n!=r)return n[0]<r[0]?-1:n[0]==r[0]&&n[1]<r[1]?-1:1;var i=t.next.origin.v;return it(n,e.next.origin.v,i)>0?-1:1}),n=e.origin,r=e.prev.origin,i=e.next.origin;return r==i||it(r.v,n.v,i.v)<0}function kt(t,e,n){var r=[t.origin,t.next.origin],i=r[0],o=r[1],s=Pt(i,e,n),u=Pt(o,e,n),a=Pt(t.prev.origin,e,n);if(!s&&u)return Et.NONE;if(s&&u)return Et.DEGENERATE;if(a&&s&&!u)return Et.NONE;if(!a&&s&&!u)return Et.VERT;var c=function(t){return it(e,n,t.v)>0};return c(i)==c(o)?Et.NONE:Et.EDGE}function It(t,e,n,r){null==r&&(r=t);for(var i=t;;){var o=kt(i,e,n);if(o!=Et.NONE)return[o,i];if((i=i.next)==r)return[Et.NONE,t]}}function Pt(t,e,n){var r=st(t.v,e,n);return r>=nt&&r<=3*nt&&console.error("NEAR MISS: dist="+r+", eps="+nt),st(t.v,e,n)<nt?t.v:null}!function(t){t[t.VERT=0]="VERT",t[t.DEGENERATE=1]="DEGENERATE",t[t.EDGE=2]="EDGE",t[t.NONE=3]="NONE"}(Et||(Et={}));var _t,Dt=function(){function t(){this.verts=[],this.edges=[],this.faces=[];var t=new Vt(this,!0);this.faces.push(t)}return t.prototype.initializeBox=function(t){var e,n,r,i;void 0===t&&(t=.8),e=new Ot(-t,t,this),n=new Ot(t,t,this),r=new Ot(t,-t,this),i=new Ot(-t,-t,this),this.verts.push(e),this.verts.push(n),this.verts.push(r),this.verts.push(i),this.insertEdge(e,n),this.insertEdge(n,r),this.insertEdge(r,i),this.insertEdge(i,e)},t.prototype.toId=function(t){var e,n;if(null==t)return"null";if(t instanceof Ot)e=this.verts.indexOf(t),n="v";else if(t instanceof Ft)e=this.edges.indexOf(t),n="e";else{if(!(t instanceof Vt))throw Error("Unknown type in dcel.toId");e=this.faces.indexOf(t),n="f"}var r=this.edges.length>50?3:2;return e<0?n+"???":n+function(t,e){var n=t.toFixed(0),r=Math.max(0,e-n.length);if(r>32)throw Error("intStrZeroPad doesn't work past 32 zeroes");return"00000000000000000000000000000000".slice(0,r)+n}(e,r)},t.prototype.toStringElem=function(t){var e="",n=this.toId(t);if(t instanceof Ot){var r=function(t){return(t<0?"":" ")+t.toFixed(2)};e="["+n+": ("+r(t.v[0])+","+r(t.v[1])+"), e="+this.toId(t.someEdgeAway)+"]"}else if(t instanceof Ft)e="["+n+": o="+this.toId(t.origin)+", t="+this.toId(t.twin)+", n="+this.toId(t.next)+", p="+this.toId(t.prev)+", f="+this.toId(t.face)+"]";else if(t instanceof Vt){e="["+n+":"+(t.isInf?" inf":"")+(null!=t.site?" "+vt(t.site):"")+" e="+this.toId(t.someEdge)+"]"}return e},t.prototype.toString=function(){var t=this;return"DCEL{\n verts= "+this.verts.map(function(e){return t.toStringElem(e)}).join(",\n        ")+"\n\n edges= "+this.edges.map(function(e){return t.toStringElem(e)}).join(",\n        ")+"\n\n faces= "+this.faces.map(function(e){return t.toStringElem(e)}).join(",\n        ")+"\n}"},t.prototype.getHalfEdgeHittingRay=function(t,e){var n=t.someEdgeAway;if(null==n)return null;return Mt(n.prev,function(t){return t.next.twin},function(n,r){return ct(t.v,e.v,n.origin.v)-ct(t.v,e.v,r.origin.v)})},t.prototype.insertEdge=function(t,e){var n=new Ft(this),r=new Ft(this);function i(t,e){t.next=e,e.prev=t}function o(t,e,n,r){null==e?(i(r,n),t.someEdgeAway=n):(i(r,e.next),i(e,n))}n.twin=r,r.twin=n,n.origin=t,r.origin=e;var s=this.getHalfEdgeHittingRay(t,e),u=this.getHalfEdgeHittingRay(e,t);if(o(t,s,n,r),o(e,u,r,n),0==this.edges.length)this.faces[0].someEdge=n,n.face=r.face=this.faces[0];else{if(n.next==n.prev)throw Error("Can't insert unconnected edges after the first");n.next==r?(n.face=n.prev.face,r.face=r.next.face):(n.face=n.next.face,r.face=r.prev.face)}return At(n,function(t){return t.next},n.twin)||function t(e){var n=e.face,r=new Vt(e.dcel);if(n.isInf&&St(e.twin))t(e.twin);else{n.someEdge=e,r.someEdge=e.twin,e.face=n,e.twin.face=r,bt(e,function(t){return t.next},function(t){t.face=e.face}),bt(e.twin,function(t){return t.next},function(t){t.face=e.twin.face});var i=n.site;if(null!=i){var o=void 0,s=e.getPoints();(o=it(s[0],s[1],e.face.site)>0?e:e.twin).face.site=i,o.twin.face.site=null}e.dcel.faces.push(r)}}(n),this.edges.push(n),this.edges.push(r),_t.verifyAll(this),n},t.prototype.getFeatureNearPoint=function(t,e){if(void 0===e&&(e=.01),this.verts.length>0){var n=pt(this.verts,function(e){return r.dist(e.v,t)});if(r.dist(n.v,t)<e)return n}function i(e){var n=e.getPoints(),r=n[0],i=n[1];return ut(t,r,i)}if(this.edges.length>0){var o=pt(this.edges,i);if(i(o)<e){var s=o.getPoints();return it(s[0],s[1],t)>=0?o:o.twin}}for(var u=0;u<this.faces.length;u++)if(this.faces[u].containsPoint(t))return this.faces[u];return null},t}(),Ot=function(){function t(t,e,n){this.dcel=n,this.v=r.fromValues(t,e),this.someEdgeAway=null}return t.prototype.toString=function(){return this.dcel.toStringElem(this)},t.prototype.delete=function(){this.someEdgeAway=null;var t=this.dcel.verts.indexOf(this);if(t<0)throw Error("vertex not in own dcel list");this.dcel.verts.splice(t,1)},t}(),Ft=function(){function t(t){this.dcel=t}return t.prototype.toString=function(){return this.dcel.toStringElem(this)},t.prototype.getPoints=function(){return[this.origin.v,this.next.origin.v]},t.prototype.split=function(e){if(null==function(t,e){var n=e.getPoints(),r=n[0],i=n[1];return ot(r,t)||ot(i,t)?null:ut(t,r,i)>nt?null:t}(e,this))return console.error("split edge: point not on edge"),null;this.origin;var n=this.next.origin,r=new Ot(e[0],e[1],this.dcel),i=new t(this.dcel),o=new t(this.dcel),s=this.twin;return i.origin=r,i.twin=o,i.face=this.face,o.origin=n,o.twin=i,o.face=this.twin.face,s.origin=r,r.someEdgeAway=i,n.someEdgeAway=o,t.linkEdges(i,this.next),t.linkEdges(this.twin.prev,o),t.linkEdges(this,i),t.linkEdges(o,s),this.dcel.edges.push(i),this.dcel.edges.push(o),this.dcel.verts.push(r),_t.verifyAll(this.dcel),this},t.prototype.deleteEdge=function(){var e=this.twin,n=this.origin,r=this.twin.origin;At(this,function(t){return t.next},e)||function t(e){var n=e.face,r=e.twin.face,i=e.dcel.faces.indexOf(r);if(i<0)throw Error("face not in dcel in mergeFaces");if(r.isInf){if(n.isInf)throw Error("Merging face when both sides are inf: "+e);t(e.twin)}else{if(null!=r.site){if(null!=n.site)throw Error("Can't merge two faces both with sites: "+n+" "+r);n.site=r.site}bt(e.twin,function(t){return t.next},function(t){return t.face=n}),e.dcel.faces.splice(i,1)}}(this);var i=this.face;t.linkEdges(this.prev,e.next),t.linkEdges(e.prev,this.next),e.next==this?n.delete():(n.someEdgeAway=this)&&(n.someEdgeAway=e.next),this.next==e?r.delete():(r.someEdgeAway=e)&&(r.someEdgeAway=this.next);var o=this.dcel.edges.indexOf(this);this.dcel.edges.splice(o,1);var s=this.dcel.edges.indexOf(e);return this.dcel.edges.splice(s,1),this.next=this.prev=this.twin=this.origin=this.face=null,e.next=e.prev=e.twin=e.origin=e.face=null,_t.verifyAll(this.dcel),i},t.prototype.deleteEdgeString=function(){var t=this.next,e=this.twin.next;function n(t){if(t.prev==t.twin){if(t.face!=t.twin.face)throw Error("Edge is strand, but has different faces: "+t+", twin="+t.twin);var e=t.next;t.deleteEdge(),n(e)}}this.deleteEdge(),n(t),n(e),_t.verifyAll(this.dcel)},t.linkEdges=function(t,e){t.next=e,e.prev=t},t}(),Vt=function(){function t(t,e){void 0===e&&(e=!1),this.dcel=t,this.isInf=e,this.site=null}return t.prototype.toString=function(){return this.dcel.toStringElem(this)},t.prototype.containsPoint=function(t){if(!this.someEdge)return!1;var e=!0;return bt(this.someEdge,function(t){return t.next},function(n){var r=n.getPoints();it(r[0],r[1],t)<0&&(e=!1)}),e},t.prototype.splitWithLine=function(t,e){if(!this.someEdge)return console.error("Trying to split empty face"),null;var n=It(this.someEdge,t,e),i=n[0],o=n[1];if(i==Et.NONE)throw Error("No intersections found");if(i==Et.DEGENERATE)throw Error("Degenerate intersection found");var s=It(o.next,t,e,o),u=s[0],a=s[1];if(u==Et.NONE)throw Error("Only one intersection found");if(u==Et.DEGENERATE)throw Error("Degenerate intersection found");var c,f,l=function(n,r,i){var o=n.getPoints(),s=at(o[0],o[1],t,e);if(null==s)return null;var u=n.split(s);return null==u?null:u.next.origin};if(i==Et.VERT?c=o.origin:i==Et.EDGE&&(c=l(o)),u==Et.VERT?f=a.origin:u==Et.EDGE&&(f=l(a)),null==c||null==f)throw Error("SplitedgewithLine failed in Face.splitWithLine");var d=this.dcel.insertEdge(c,f),h=d.getPoints(),g=h[0],v=h[1],p=r.create();r.sub(p,e,t);var w=r.create();return r.sub(w,v,g),r.dot(p,w)<0?d.twin:d},t}();!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return mt(e,t),e}(Error);function n(t,n,r){if(void 0===n&&(n=""),null!=r&&(n+=": "+r.toString()),!t)throw new e(n)}function r(t,e){var r;if(n(null!=e,"elem is null",e),n(e.dcel==t,"dcel doesn't match elem.dcel",e),e instanceof Ft)r=t.edges;else if(e instanceof Ot)r=t.verts;else{if(!(e instanceof Vt))throw Error("Unkown Type in isElemInDCEL: "+e);r=t.faces}return r.indexOf(e)>=0}function i(t,e){n(e.dcel==t,"dcel doesn't match e.dcel"),n(r(t,e.prev),"prev not in dcel",e),n(r(t,e.next),"next not in dcel",e),n(r(t,e.twin),"twin not in dcel",e),n(r(t,e.face),"face not in dcel",e),n(r(t,e.origin),"origin not in dcel",e),n(e.next.prev==e,"next doesn't link back",e),n(e.prev.next==e,"prev doesn't link back",e),n(e.twin.twin==e,"twin doesn't link back",e),n(e.next.origin==e.twin.origin,"next and twin should have same origin",e),n(e.face==e.next.face,"next doesn't share a face with me",e);var i=e.origin.someEdgeAway;n(null!=i,"origin should have some edge"),n(At(e,function(t){return t.twin.next},i),"should be able reach all edges around origin, can't reach "+(i&&i.toString()),e)}function o(t,e){n(e.dcel==t,"dcel doesn't match v.dcel"),null!=e.someEdgeAway&&(n(r(t,e.someEdgeAway),"someEdgeAway not in dcel",e),n(e.someEdgeAway.origin==e,"someEdgeAway doesn't have me as origin",e))}function s(t,e){(n(e.dcel==t,"dcel doesn't match f.dcel",e),null!=e.someEdge)&&(n(r(t,e.someEdge),"someEdge not in dcel",e),n(e.someEdge.face==e,"someEdge doesn't have me as face",e),bt(e.someEdge,function(t){return t.next},function(t){n(e.someEdge.face==e,"edge "+t.toString()+" in my component doesn't have me as face",e)}),n(0==t.faces.indexOf(e)==e.isInf,"only first face should be isInf",e),n(St(e.someEdge)==e.isInf,"only inf face should have an inner component",e))}function u(t){t.edges.forEach(function(e){i(t,e)}),t.verts.forEach(function(e){o(t,e)}),t.faces.forEach(function(e){s(t,e)})}t.verifyAll=function(t){yt||u(t)},t.verifyExplicit=u}(_t||(_t={}));var Nt=function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{a(r.next(t))}catch(t){o(t)}}function u(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,u)}a((r=r.apply(t,e||[])).next())})},Tt=function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};var Lt=function(){function t(t){var e=this;this.canvas=t,this.VERT_RADIUS=3,this.SITE_RADIUS=5,this.MOUSE_RADIUS=.05,this.STEP_DELAY=500,this.is_already_inserting=!1,this.lastMousePos=r.create(),this.highlightedFeature=null;var n=document.getElementById("textbox");if(null==n)throw Error("Need element #textbox to inject ui into");this.makeOptionsBox(n),this.dcel=new Dt,window.dcel=this.dcel,window.integ=_t,window.dcel_module=i,window.vor=this,this.dcel.initializeBox(1),console.log(this.dcel.toString()),this.canvas.canvas.addEventListener("mousemove",function(t){return e.handleMouseMove(t)}),this.canvas.canvas.addEventListener("mousedown",function(t){return e.handleMouseClick(t)})}return t.prototype.makeOptionsBox=function(t){t.innerHTML="",this.textbox=ht("div","@style= font-size:1.5rem; height: 2.5rem"),this.checkbox_slow_add=ht("input","#check-slow","@type=checkbox");var e=ht("div",this.textbox,ht("div",ht("label","@for=check-slow","Add sites step-by-step"),this.checkbox_slow_add));t.insertAdjacentElement("beforeend",e)},t.prototype.drawVert=function(t,e){void 0===e&&(e="black"),this.canvas.putPoint(t.v,this.VERT_RADIUS,e)},t.prototype.drawHalfEdge=function(t,e){void 0===e&&(e="black");var n=t.origin.v,r=t.next.origin.v;this.canvas.putLine(n,r,e);var i=lt(n,r,.4,.1*.1),o=lt(n,r,.6,.1*.1),s=lt(n,r,.54,.04);this.canvas.putLine(i,o,e),this.canvas.putLine(o,s,e)},t.prototype.drawFace=function(t,e){void 0===e&&(e="black"),null!=t.site&&this.canvas.putPoint(t.site,this.SITE_RADIUS,e)},t.prototype.drawFeature=function(t,e){if(void 0===e&&(e="black"),null!=t)if(t instanceof Ot)this.drawVert(t,e);else if(t instanceof Ft)this.drawHalfEdge(t,e);else{if(!(t instanceof Vt))throw Error("drawFeature not implemented for"+t);this.drawFace(t,e)}},t.prototype.debugDrawFeature=function(t,e){if(void 0===e&&(e="black"),null!=t)if(t instanceof Ot)this.debugDrawVert(t);else if(t instanceof Ft)this.debugDrawHalfEdge(t);else{if(!(t instanceof Vt))throw Error("debugDrawFeature not implemented for"+t);this.debugDrawFace(t)}},t.prototype.debugDrawVert=function(t){this.drawVert(t,"red"),t.someEdgeAway&&this.drawHalfEdge(t.someEdgeAway,"gold")},t.prototype.debugDrawHalfEdge=function(t){this.drawVert(t.origin,"red"),this.drawHalfEdge(t.twin,"gold"),this.drawHalfEdge(t.prev,"magenta"),this.drawHalfEdge(t,"red"),this.drawHalfEdge(t.next,"deepskyblue")},t.prototype.debugDrawFace=function(t){var e=this;null!=t.someEdge&&(bt(t.someEdge,function(t){return t.next},function(t){return e.drawHalfEdge(t,"limegreen")}),this.drawHalfEdge(t.someEdge,"red")),null!=t.site&&this.canvas.putPoint(t.site,this.VERT_RADIUS,"red")},t.prototype.draw=function(){var t=this;this.canvas.clear(),this.dcel.verts.forEach(function(e){return t.drawVert(e)}),this.dcel.edges.forEach(function(e){return t.drawHalfEdge(e)}),this.dcel.faces.forEach(function(e){return t.drawFace(e)}),this.debugDrawFeature(this.highlightedFeature)},t.prototype.update=function(){var t=this.dcel.getFeatureNearPoint(this.lastMousePos,this.MOUSE_RADIUS);this.highlightedFeature=t,this.textbox.textContent=t&&t.toString()},t.prototype.eventToCoords=function(t){var e=this.canvas.canvas.getBoundingClientRect();return[t.clientX-e.left,t.clientY-e.top]},t.prototype.handleMouseMove=function(t){var e=this.eventToCoords(t),n=e[0],i=e[1],o=this.canvas.screen2world(r.fromValues(n,i));this.lastMousePos.set(o),this.update(),this.draw()},t.prototype.handleMouseClick=function(t){return Nt(this,void 0,void 0,function(){var e,n,i,o,s,u;return Tt(this,function(a){switch(a.label){case 0:return e=this.eventToCoords(t),n=e[0],i=e[1],o=this.canvas.screen2world(r.fromValues(n,i)),s=this.dcel.getFeatureNearPoint(o,this.MOUSE_RADIUS/10),console.log("Clicked! : "+(s&&s.toString())),console.log("inserting?: "+this.is_already_inserting),this.is_already_inserting?(console.log("Already inserting, returning early"),[2]):[3,1];case 1:return a.trys.push([1,5,6,7]),s instanceof Vt?(this.is_already_inserting=!0,[4,this.doAddSite(s,o)]):[3,3];case 2:return a.sent(),[3,4];case 3:a.label=4;case 4:return[3,7];case 5:return u=a.sent(),console.error(u),[3,7];case 6:return this.update(),this.draw(),this.is_already_inserting=!1,[7];case 7:return[2]}})})},t.prototype.doDeleteEdge=function(t){t.deleteEdge(),_t.verifyAll(this.dcel)},t.prototype.delay=function(){var t=this;return this.checkbox_slow_add.checked?(console.log("delaying"),this.update(),this.draw(),new Promise(function(e,n){setTimeout(e,t.STEP_DELAY)})):(console.log("skipping delay"),Promise.resolve())},t.prototype.done=function(){},t.prototype.doAddSite=function(t,e){return Nt(this,void 0,void 0,function(){var n,r,i,o;return Tt(this,function(s){switch(s.label){case 0:if(null==t.site)return t.site=e,[2];if(ot(t.site,e))return console.error("duplicate site, ignoring"),[2];if(console.log("Doing doAddSite"),n=lt(e,t.site,.5,-1),r=lt(e,t.site,.5,1),null==(i=t.splitWithLine(n,r)))throw Error("Failed to split with line");if(null!=i.face.site)throw Error("New face should have null site: new face:"+i.face);return(o=i.face).site=e,[4,this.delay()];case 1:return s.sent(),[2,this.doFixupEdgesBidirectional(o,i,i,!0)]}})})},t.prototype.doFixupEdgesBidirectional=function(t,e,n,r){return Nt(this,void 0,void 0,function(){var i,o,s,u,a,c,f,l,d;return Tt(this,function(h){switch(h.label){case 0:if(console.log("Fixing up "+(r?"CCW":"CW")+" at "+n.toString()),i=r?n.next.twin:n.prev.twin,o=r?n.twin.prev.twin:n.twin.next.twin,s=r?n.next:n.prev,u=r?n.next.origin:n.origin,s==e)return console.log("Finished a full loop, done"),[2];if((i.face.isInf||o.face.isInf)&&r)return console.log("next is inf, reversing"),[2,this.doFixupEdgesBidirectional(t,n,e,!1)];if((i.face.isInf||o.face.isInf)&&!r)return console.log("hit inf, twice, done"),[2];if(a=i.face,null==(c=a.site))return console.error("hit null site"),[2];if(null==t.site)throw Error("TargetFace shouldn't have null site: "+t);if(f=u.v,l=lt(t.site,c,.5,r?1:-1),null==(d=a.splitWithLine(f,l)))throw Error("Failed to split with line");if(null!=d.face.site&&(d=d.twin,console.log("Site on wrong side, flipping : "+d)),null!=d.face.site)throw Error("Neither face on new_edge has null site. new face:"+d.face);return i.deleteEdgeString(),[4,this.delay()];case 1:return h.sent(),[2,this.doFixupEdgesBidirectional(t,e,d,r)]}})})},t}();n.d(e,"init",function(){return Ht}),console.log("Loaded bundle");var Rt=Object.create(null);Rt["convex-hull"]=function(t){console.log("Loaded ConvexHull"),W=t,function(){W.drawAxes();for(var t=[],e=0;e<100;e++)t.push(gt());var n=t.slice();console.time("giftwrap");var i=function(t){t.sort(function(t,e){return t[0]!=e[0]?t[1]-e[1]:-1*(t[0]-e[0])});var e=t.shift();function n(e,n){var i=r.create();r.subtract(i,n,e),r.add(i,i,n);for(var o=999,s=-1,u=0;u<t.length;u++){var a=ft(n,i,t[u]);a<o&&(o=a,s=u)}var c=t.splice(s,1)[0];return c}var i=[e],o=r.fromValues(e[0]-1,e[1]);i.push(n(o,e));for(var s=!0;;){if(0==t.length){console.log("END: Out of points"),i.push(e);break}var u=i[i.length-2],a=i[i.length-1],c=n(u,a);if(it(a,e,c)>0){i.push(e),t.push(c),console.log("CLOSED!");break}var f=r.create();if(r.sub(f,c,a),s&&f[1]<0&&(console.log("HIT INFLECTION: going back up"),s=!1),!s&&f[1]>=0){console.log("END: sloping down"),t.push(c);break}i.push(c)}return i}(n);console.timeEnd("giftwrap"),t.forEach(function(t){return W.putPoint(t,2,"red")}),i.forEach(function(t){return W.putPoint(t,2)});for(var e=1;e<i.length;e++)W.putLine(i[e-1],i[e])}()},Rt.voronoi=function(t){console.log("Loaded Voronoi"),t,new Lt(t).draw()};var Ct="canvas";function Ht(t){var e=document.getElementById(Ct),n=new et(e);t in Rt?Rt[t](n):(console.log('Error: unknown module "'+t+'"'),console.log("Available modules are: "+Object.keys(Rt)))}window.init=Ht}});